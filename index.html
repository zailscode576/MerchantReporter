<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Traveling Merchant Reporter</title>
<style>
    body {
        font-family: Arial, sans-serif;
        font-size: 16px; /* Bigger font for easier reading */
        margin: 20px;
        background: #1e1e2f;
        color: #ddd;
    }
    h2 {
        margin-bottom: 10px;
        color: #fff;
    }
    select, input, button {
        margin: 5px 0;
        padding: 6px;
        font-size: 15px;
        background: #2a2a3d;
        color: #ddd;
        border: 1px solid #555;
        border-radius: 4px;
    }
    select:focus, input:focus {
        outline: none;
        border-color: #888;
    }
    button {
        background: #44445e;
        cursor: pointer;
    }
    button:hover {
        background: #555577;
    }
    .items-container {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    .item-block {
        flex: 1;
        background: #2a2a3d;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.4);
        min-width: 200px;
    }
    label {
        display: block;
        font-weight: bold;
        margin-top: 5px;
        color: #bbb;
        font-size: 14px;
    }
    textarea {
        width: 100%;
        height: 160px;
        margin-top: 10px;
        font-family: monospace;
        font-size: 15px;
        background: #2a2a3d;
        color: #ddd;
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #555;
        resize: none;
    }
    .credit {
    	position: fixed;
    	bottom: 5px;
    	left: 10px;
    	font-size: 12px;
    	color: #888;
    	opacity: 0.7;
    }
    .credit:hover {
    	opacity: 1;
    }

</style>
</head>
<body>

<h2>Traveling Merchant Reporter</h2>

<label for="location">Merchant Location:</label>
<select id="location">
    <option>Azuralite Oasis</option>
    <option>Caldera Island</option>
    <option>Fortune River</option>
    <option>Fortune River Delta</option>
    <option>Sunset Beach</option>
    <option>Windswept Beach</option>
</select>

<div class="items-container" id="items"></div>

<button onclick="downloadReport()">Download as TXT</button>

<button onclick="copyToClipboard()">Copy to Clipboard</button>

<textarea id="output" readonly></textarea>

<script>
let itemsList = [
    { name: "Perfect Reforge Token", coins: "$50,000,000,000", shards: "5,000", stock: 1 },
    { name: "Traveler's Backpack", coins: "$1,000,000,000", shards: "1,000", stock: "3" },
    
    { name: "Solar Token", coins: "$500,000,000", shards: "600", stock: 1, category: "Fragments" },
    { name: "Meteor Fragment", coins: "$5,000,000,000", shards: "1,500", stock: 1, category: "Fragments" },

    { name: "Prismatic Enchant Book", coins: "$20,000,000,000", shards: "5,000", stock: 1, category: "Enchants" },
    { name: "Infernal Enchant Book", coins: "$20,000,000,000", shards: "5,000", stock: 1, category: "Enchants" },
    { name: "Cosmic Enchant Book", coins: "$10,000,000,000", shards: "2,000", stock: 1, category: "Enchants" },
    { name: "Divine Enchant Book", coins: "$10,000,000,000", shards: "2,000", stock: 1, category: "Enchants" },
    { name: "Blessed Enchant Book", coins: "$200,000,000", shards: "750", stock: 1, category: "Enchants" },
    { name: "Destructive Enchant Book", coins: "$200,000,000", shards: "750", stock: 1, category: "Enchants" },
    { name: "Midas Enchant Book", coins: "$200,000,000", shards: "750", stock: 1, category: "Enchants" },
    { name: "Glowing Enchant Book", coins: "$50,000,000", shards: "400", stock: 1, category: "Enchants" },
    { name: "Titanic Enchant Book", coins: "$50,000,000", shards: "400", stock: 1, category: "Enchants" },
    { name: "Unstable Enchant Book", coins: "$50,000,000", shards: "400", stock: 1, category: "Enchants" },

    // Set ppotions and prices when possible
    { name: "Blitz Potion", coins: "$200,000,000", shards: "250", stock: 3, category: "Potions" },
	{ name: "Instability Potion", coins: "$200,000,000", shards: "150", stock: 3, category: "Potions" },
	{ name: "Quake Potion", coins: "?", shards: "200", stock: 3, category: "Potions" }
];

// Sort enchant books
function parsePrice(str) {
    return parseInt(str.replace(/[^0-9]/g, ""), 10);
}
let enchantBooks = itemsList.filter(i => i.category === "Enchants")
    .sort((a, b) => {
        let priceA = parsePrice(a.coins);
        let priceB = parsePrice(b.coins);
        if (priceA !== priceB) return priceB - priceA;
        return a.name.localeCompare(b.name);
    });

let fragments = itemsList.filter(i => i.category === "Fragments");
let potions = itemsList.filter(i => i.category === "Potions");
let other = itemsList.filter(i => !i.category);

const container = document.getElementById("items");

for (let i = 0; i < 4; i++) {
    const div = document.createElement("div");
    div.className = "item-block";
    div.innerHTML = `
        <label>Item ${i + 1}:</label>
        <select class="item-select">
            <option value="">-- Select Item --</option>
            <optgroup label="Event Summons">
                ${fragments.map(item => `<option value="${item.name}">${item.name}</option>`).join("")}
            </optgroup>
            <optgroup label="Enchants">
                ${enchantBooks.map(item => `<option value="${item.name}">${item.name}</option>`).join("")}
            </optgroup>
            <optgroup label="Potions">
                ${potions.map(item => `<option value="${item.name}">${item.name}</option>`).join("")}
            </optgroup>
            <optgroup label="Other">
                ${other.map(item => `<option value="${item.name}">${item.name}</option>`).join("")}
            </optgroup>
        </select>
        <label>Cost Type:</label>
        <select class="cost-type">
            <option value="coins">Coins</option>
            <option value="shards">Shards</option>
        </select>
        <div class="stock-div">
            <label>Stock:</label>
            <input type="number" min="1" class="stock-input" value="1">
        </div>
    `;
    container.appendChild(div);
}

function updateStockField(selectElem) {
    const selectedItem = itemsList.find(item => item.name === selectElem.value);
    const stockDiv = selectElem.parentElement.querySelector(".stock-div");
    if (selectedItem && selectedItem.stock === 1) {
        stockDiv.style.display = "none";
    } else {
        stockDiv.style.display = "block";
        const stockInput = stockDiv.querySelector(".stock-input");
        stockInput.value = selectedItem && selectedItem.stock !== 1 ? selectedItem.stock : 1;
    }
}

function copyToClipboard() {
    const output = document.getElementById("output");
    output.select(); // Select the text
    output.setSelectionRange(0, 99999); // For mobile devices
    navigator.clipboard.writeText(output.value);
}

function updateReport() {
    const location = document.getElementById("location").value;
    let report = `**# Traveling Merchant Location and Stock**\n**Location: ${location}**\n\n`;

    const categories = {
        "Fragments": [],
        "Enchants": [],
        "Potions": [],
        "Other": []
    };

    const itemBlocks = document.querySelectorAll(".item-block");
    itemBlocks.forEach(block => {
        const itemName = block.querySelector(".item-select").value;
        const costType = block.querySelector(".cost-type").value;
        const stockDiv = block.querySelector(".stock-div");
        const stock = stockDiv.style.display === "none" ? 1 : block.querySelector(".stock-input").value;

        if (itemName) {
            const itemData = itemsList.find(item => item.name === itemName);
            const price = costType === "coins" ? itemData.coins : itemData.shards + " meteor shards";
            const line = { 
                text: `â€¢ \`${stock}x ${itemName} - ${price}\``, 
                sortValue: parseInt(itemData.coins.replace(/[^0-9]/g,"")) 
            };
            const category = itemData.category || "Other";
            categories[category].push(line);
        }
    });

    for (let cat of ["Fragments", "Enchants", "Potions", "Other"]) {
        if (categories[cat].length > 0) {
            let displayName = cat === "Fragments" ? "Event Summons" : cat;
            categories[cat].sort((a, b) => b.sortValue - a.sortValue);
            report += `**${displayName}:**\n${categories[cat].map(item => item.text).join("\n")}\n\n`;
        }
    }

    const unixTime = Math.floor(Date.now() / 1000);
    report += `**Report generated:** <t:${unixTime}:f>`;

    document.getElementById("output").value = report.trim();
}

function downloadReport() {
    const text = document.getElementById("output").value;
    if (!text) return alert("Enter merchant data first!");
    const blob = new Blob([text], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "merchant_report.txt";
    a.click();
}

// Live updates
document.getElementById("location").addEventListener("change", updateReport);
document.querySelectorAll(".item-select").forEach(sel => {
    sel.addEventListener("change", function() {
        updateStockField(this);
        updateReport();
    });
});
document.querySelectorAll(".cost-type").forEach(sel => {
    sel.addEventListener("change", updateReport);
});
document.querySelectorAll(".stock-input").forEach(input => {
    input.addEventListener("input", updateReport);
});
</script>

<div class="credit">Made by zailscode576</div>

</body>
</html>
